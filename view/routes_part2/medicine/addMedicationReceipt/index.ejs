<!DOCTYPE html>
<html>

<head>
    <title>New Medication Receipt</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Koulen&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../res_addMedicineReceipt/styles.css">
</head>

<body>
    <p class="hidden" id="hidden-data">
        <%= JSON.stringify({medications: medications, beneficiaries: beneficiaries, patients: patients, sourceCodes: sourceCodes, currencies: currencies}) %>
    </p>
    <% let currentPatient = patients.filter(e=> e.beneficiary_id == queries.patientid)%>
        <nav class="navbar-my container-fluid">
            <div class="row">
                <div class="col-1 nav-buttons">
                    <a href="/medicine" class="back-button"><i class="fa-solid fa-circle-left"></i></a>
                </div>
                <div class="col-10">
                    <h1>New Medication Receipt</h1>
                </div>
                <div class="col-1"></div>
            </div>
        </nav>

        <form method="post" autocomplete="off" onkeydown="return event.key != 'Enter';">

        <div class="container-fluid">
            <div class="row">
                <div class="col"></div>
                <div class="col-3">
                    <label for="personNameInput">Person:</label>
                </div>
                <div class="col"></div>
            </div>
            <div class="row">
            <div class="col"></div>
                <div class="col-3">
                    <select name="patientid" onchange="newRedirect()" id="personNameInput" class="person">
                        <% let peopleArray = beneficiaries %>
                        <option></option>
                        <% for(let i=0; i<peopleArray.length; i++){ %>
                        <option value="<%= peopleArray[i].b_id %>" <%if(peopleArray[i].b_id == queries.patientid){%>selected<%}%>>
                        <%= peopleArray[i].first_name + " " + peopleArray[i].middle_name + " " + peopleArray[i].last_name%>
                        </option>
                        <% } %>
                    </select>
                </div>
            <div class="col"></div>
            </div> 
        </div>

            <div class="container-fluid">
            <div class="row">
                <div class="col"></div>
                <div class="col-8">

                    <div class="row">
                        <div class="col"></div>
                        <div class="col-1">
                            <p class="btn btn-primary add-record" onclick="addNewRow(), updateIDs(), checkForm()">+</p>
                        </div>
                    </div>

                    <table class="table table-bordered main-table text-center" id="main-table">
                        <tr class="text-center bg-dark" id="first-row">
                            <th>#</th>
                            <th>Medication</th>
                            <th>Source</th>
                            <th>Price</th>
                            <th>Comment</th>
                            <th></th>
                        </tr>

                        <tr>
                            <tr class="data-row" id="1">

                                <td class="id-td">
                                    1
                                </td>
                    
                    
                                <td>
                                    <select name="medicationpost" class="table-select medicine" onchange="checkForm()">
                                        <option value="" selected> </option>
                                        <%for(let i=0; i<medications.length; i++){%>
                                        <option value="<%=medications[i].medicine_id%>"><%=medications[i].medicine_name%></option>
                                        <%}%>
                                    </select>
                                </td>
                    
                    
                    
                                <td>
                                    <select name="sourcepost" class="table-select source" onchange="checkForm()">
                                        <option value="" selected> </option>
                                        <%for(let i=0; i<sourceCodes.length; i++){%>
                                        <option value="<%=sourceCodes[i].sourceCode%>"><%=sourceCodes[i].sourceName%></option>
                                        <%}%>
                                    </select>
                                </td>
                    
                    
                                <td>
                                    <input type="number" name="pricepost" placeholder="L.L" class="table-input price" min="0" oninput="checkForm()">
                                </td>
                    
                                <td>
                                    <input type="text" name="commentpost" maxlength="254" class="table-input">
                                </td>
                    
                                <td><i class="fa-solid fa-trash del-icon" id="1" onclick="removeRow(this), checkForm()"></i</td>
                        </tr>

                        <input id="form-meta" class="hidden" name="medicationqty" value="1">
                    </table>
                    <div class="row">
                        <div class="col"></div>
                        <input type="submit" value="Add" class="btn btn-success faded" id="submit-btn">
                        <div class="col"></div>
                    </div>
                </div>
                <div class="col"></div>
            </div>
        </div>

        </form>



        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
        <script src="https://kit.fontawesome.com/5853267fcd.js" crossorigin="anonymous"></script>
        <script src="../../res_addMedicineReceipt/dynamic.js"></script>
</body>

</html>